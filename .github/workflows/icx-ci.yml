name: 'ICX-PROXY - CI'
on: 
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - "*"

jobs:
  build-image:
    runs-on: ubuntu-latest 
    outputs:
      image_id: ${{steps.image_push.outputs.image_id}}
    steps:
    - name: Checkout Repo
      uses: actions/checkout@v3
    
    - name: Checkout NFT Repo
      uses: actions/checkout@v3
      with:
        repository: ORIGYN-SA/origyn_nft
        token: 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
        path: origyn_nft
    
    - name: Checkout Phonebook Repo
      uses: actions/checkout@v3
      with:
        repository: ORIGYN-SA/phone_book
        token: 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
        path: phone_book

    - name: NFT, Phonebook, Redis and Icx Proxy Service
      uses: isbang/compose-action@v1.3.2
      with:
        compose-file: "icx-proxy/.ci/docker-compose.yml"

    - name: Deploy NFTs
      uses: actions/setup-node@v3
      with:
        node-version: 16
      run: ./icx-proxy/.ci/deploy_mock_nfts.sh


  deploy-docker:
    needs: build-image
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    # - name: Launch Docker


